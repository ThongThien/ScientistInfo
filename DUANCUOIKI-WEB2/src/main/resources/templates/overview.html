<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Th·ªëng k√™ h·ªá th·ªëng</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        .stat-card {
            min-height: 150px;
        }
        canvas {
            max-width: 100%;
            height: auto !important;
        }
    </style>
</head>
<body>
<header th:replace="~{layout :: header}"></header>
<nav th:replace="~{layout :: menu}"></nav>
<div class="container mt-4">
    <h1 class="mb-4 text-center">Th·ªëng k√™ H·ªá th·ªëng</h1>

    <!-- 1. T·ªïng quan -->
    <h3 class="mt-5 mb-3">1. T·ªïng quan</h3>
    <div class="row text-center">
        <div class="col-md-4 mb-3">
            <div class="card stat-card shadow">
                <div class="card-body">
                    <h5 class="card-title">T·ªïng s·ªë nh√† khoa h·ªçc</h5>
                    <p class="card-text fs-4 fw-bold" th:text="${totalScientists}"></p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card stat-card shadow">
                <div class="card-body">
                    <h5 class="card-title">T·ªïng s·ªë t·ªï ch·ª©c</h5>
                    <p class="card-text fs-4 fw-bold" th:text="${totalOrganizations}"></p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card stat-card shadow">
                <div class="card-body">
                    <h5 class="card-title">T·ªïng s·ªë lƒ©nh v·ª±c nghi√™n c·ª©u</h5>
                    <p class="card-text fs-4 fw-bold" th:text="${totalResearchFields}"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. Khoa h·ªçc & h·ªçc thu·∫≠t -->
    <h3 class="mt-5 mb-3">2. Khoa h·ªçc & h·ªçc thu·∫≠t</h3>
    <div class="row text-center">
        <div class="col-md-4 mb-3">
            <div class="card stat-card shadow">
                <div class="card-body">
                    <h5 class="card-title">S·ªë l∆∞·ª£ng b√†i b√°o khoa h·ªçc</h5>
                    <p class="card-text fs-4 fw-bold" th:text="${totalArticles}"></p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card stat-card shadow">
                <div class="card-body">
                    <h5 class="card-title">S·ªë l∆∞·ª£ng s√°ch</h5>
                    <p class="card-text fs-4 fw-bold" th:text="${totalBooks}"></p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card stat-card shadow">
                <div class="card-body">
                    <h5 class="card-title">S·ªë l∆∞·ª£ng d·ª± √°n</h5>
                    <p class="card-text fs-4 fw-bold" th:text="${totalProjects}"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. Bi·ªÉu ƒë·ªì -->
    <h3 class="mt-5 mb-3">3. Bi·ªÉu ƒë·ªì ph√¢n t√≠ch</h3>
    <div class="row">
        <!-- Bi·ªÉu ƒë·ªì tr√≤n gi·ªõi t√≠nh -->
        <div class="col-md-6 mb-4">
            <div class="card shadow">
                <div class="card-body">
                    <h5 class="card-title text-center">T·ª∑ l·ªá gi·ªõi t√≠nh</h5>
                    <canvas id="genderChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Bi·ªÉu ƒë·ªì c·ªôt ng·∫°ch -->
        <div class="col-md-6 mb-4">
            <div class="card shadow">
                <div class="card-body">
                    <h5 class="card-title text-center">S·ªë l∆∞·ª£ng nh√† khoa h·ªçc theo ng·∫°ch</h5>
                    <canvas id="rankChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>
<footer th:replace="~{layout :: footer}"></footer>
<!-- Bootstrap JS bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Chart.js scripts -->
<script th:inline="javascript">
    const genderData = /*[[${genderDistribution}]]*/ {};
    const genderLabels = Object.keys(genderData);
    const genderCounts = Object.values(genderData);

    const rankData = /*[[${rankDistribution}]]*/ {};
    const rankLabels = Object.keys(rankData);
    const rankCounts = Object.values(rankData);

    // Gender Pie Chart
    new Chart(document.getElementById('genderChart'), {
        type: 'pie',
        data: {
            labels: genderLabels,
            datasets: [{
                data: genderCounts,
                backgroundColor: ['#36A2EB', '#FF6384', '#FFCE56'],
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { position: 'bottom' } }
        }
    });

 // Rank Bar Chart
    new Chart(document.getElementById('rankChart'), {
        type: 'bar',
        data: {
            labels: rankLabels,
            datasets: [{
                label: 'S·ªë l∆∞·ª£ng',
                data: rankCounts,
                backgroundColor: '#4BC0C0'
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1,     // üëà B∆∞·ªõc nh·∫£y l√† 1
                        precision: 0     // üëà Kh√¥ng c√≥ s·ªë th·∫≠p ph√¢n
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return 'S·ªë l∆∞·ª£ng: ' + parseInt(context.raw);
                        }
                    }
                }
            }
        }
    });
</script>

</body>
</html>
